<!DOCTYPE html>
<html lang="no">
<head>
<meta charset="UTF-8">
<title>Flappy Bird – forbedret</title>
<style>
  body {
    margin: 0;
    background: #222;
    display: flex;
    justify-content: center;
    align-items: center;
    height: 100vh;
  }
  canvas {
    border: 3px solid #000;
    background: linear-gradient(#6ec9ff, #b3ecff);
  }
</style>
</head>
<body>

<canvas id="game" width="420" height="640"></canvas>

<script>
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");

// Fuglen
let bird = {
  x: 100,
  y: canvas.height / 2,
  r: 18,
  vel: 0,
  gravity: 0.45,
  jump: -8.5
};

// Rør
let pipes = [];
let pipeGap = 150;
let pipeWidth = 70;
let pipeSpeed = 3;

// Spillstatus
let score = 0;
let started = false;
let gameOver = false;

// Reset
function reset() {
  bird.y = canvas.height / 2;
  bird.vel = 0;
  pipes = [];
  score = 0;
  started = false;
  gameOver = false;
}

// Lag rør
function addPipe() {
  let top = 40 + Math.random() * 260;
  pipes.push({
    x: canvas.width,
    top: top,
    bottom: top + pipeGap,
    passed: false
  });
}

// Oppdater spill
let frame = 0;
function update() {
  if (!started || gameOver) return;

  bird.vel += bird.gravity;
  bird.y += bird.vel;

  frame++;
  if (frame % 90 === 0) addPipe();

  // Oppdater rør
  for (let i = pipes.length - 1; i >= 0; i--) {
    pipes[i].x -= pipeSpeed;

    // Score
    if (!pipes[i].passed && pipes[i].x + pipeWidth < bird.x) {
      pipes[i].passed = true;
      score++;
    }

    // Fjern rør
    if (pipes[i].x + pipeWidth < 0) pipes.splice(i, 1);
  }

  // Kollisjon med bakken/tak
  if (bird.y + bird.r > canvas.height || bird.y - bird.r < 0) {
    gameOver = true;
  }

  // Kollisjon med rør
  for (let p of pipes) {
    if (
      bird.x + bird.r > p.x &&
      bird.x - bird.r < p.x + pipeWidth &&
      (bird.y - bird.r < p.top || bird.y + bird.r > p.bottom)
    ) {
      gameOver = true;
    }
  }
}

// Tegn fugl
function drawBird() {
  ctx.fillStyle = "#ffeb3b";
  ctx.beginPath();
  ctx.arc(bird.x, bird.y, bird.r, 0, Math.PI * 2);
  ctx.fill();

  // Øye
  ctx.fillStyle = "#000";
  ctx.beginPath();
  ctx.arc(bird.x + 6, bird.y - 5, 3, 0, Math.PI * 2);
  ctx.fill();
}

// Tegn rør
function drawPipes() {
  for (let p of pipes) {
    ctx.fillStyle = "#2ecc71";
    ctx.fillRect(p.x, 0, pipeWidth, p.top);
    ctx.fillRect(p.x, p.bottom, pipeWidth, canvas.height - p.bottom);

    // Skygge
    ctx.fillStyle = "rgba(0,0,0,0.2)";
    ctx.fillRect(p.x + pipeWidth - 5, 0, 5, p.top);
    ctx.fillRect(p.x + pipeWidth - 5, p.bottom, 5, canvas.height - p.bottom);
  }
}

// Bakgrunn
function drawBackground() {
  ctx.fillStyle = "#6ec9ff";
  ctx.fillRect(0, 0, canvas.width, canvas.height);

  // Bakke
  ctx.fillStyle = "#d9c27a";
  ctx.fillRect(0, canvas.height - 60, canvas.width, 60);

  ctx.fillStyle = "#4caf50";
  ctx.fillRect(0, canvas.height - 70, canvas.width, 10);
}

// Tekst
function drawText() {
  ctx.fillStyle = "#fff";
  ctx.font = "28px Arial";
  ctx.fillText("Score: " + score, 10, 40);

  if (!started && !gameOver) {
    ctx.font = "30px Arial";
    ctx.fillText("Trykk SPACE for å starte", 40, canvas.height / 2);
  }

  if (gameOver) {
    ctx.font = "40px Arial";
    ctx.fillText("GAME OVER", 110, canvas.height / 2 - 20);

    ctx.font = "24px Arial";
    ctx.fillText("Score: " + score, 170, canvas.height / 2 + 20);
    ctx.fillText("Trykk SPACE for å restarte", 80, canvas.height / 2 + 60);
  }
}

// Spill-loop
function loop() {
  update();

  drawBackground();
  drawPipes();
  drawBird();
  drawText();

  requestAnimationFrame(loop);
}

// Kontroller
document.addEventListener("keydown", (e) => {
  if (e.code === "Space") {
    if (!started) started = true;
    if (gameOver) return reset();
    bird.vel = bird.jump;
  }
});

// Start
reset();
loop();
</script>

</body>
</html>
