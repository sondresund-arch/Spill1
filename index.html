<!DOCTYPE html>
<html lang="no">
<head>
<meta charset="UTF-8">
<title>Flappy Bird – Fullskjerm</title>
<style>
body {
   margin: 0;
   background: #222;
   overflow: hidden;
   height: 100vh;
   width: 100vw;
}
canvas {
   display: block;
   background: linear-gradient(#6ec9ff, #b3ecff);
}
</style>
</head>
<body>
<canvas id="game"></canvas>
<script>
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");

// Fullskjerm
function resizeCanvas() {
  canvas.width = window.innerWidth;
  canvas.height = window.innerHeight;
}
window.addEventListener('resize', resizeCanvas);
resizeCanvas();

// Fuglen
let bird = {
  x: 100,
  y: canvas.height / 2,
  r: 18,
  vel: 0,
  gravity: 0.45,
  jump: -6.2 // Litt høyere hopp
};

// Rør
let pipes = [];
let pipeGap = 170;
let pipeWidth = 80;
let pipeSpeed = 3.5;

// Spillstatus
let score = 0;
let started = false;
let gameOver = false;
let paused = false;

// Reset
function reset() {
  bird.y = canvas.height / 2;
  bird.vel = 0;
  pipes = [];
  score = 0;
  started = false;
  gameOver = false;
  paused = false;

  pipeGap = 170;
  pipeSpeed = 3.5;
}

// Lag rør
function addPipe() {
  let minHeight = 50;
  let maxHeight = canvas.height - 60 - pipeGap - minHeight;
  let top = minHeight + Math.random() * (maxHeight - minHeight);

  pipes.push({
    x: canvas.width,
    top: top,
    bottom: top + pipeGap,
    passed: false
  });
}

// Oppdater spill
let frame = 0;
function update() {
  if (!started || gameOver || paused) return;

  bird.vel += bird.gravity;
  bird.y += bird.vel;
  frame++;

  // Vanskelighet øker etter hvert
  if (score > 5) pipeSpeed = 4.2;
  if (score > 10) pipeSpeed = 4.8;
  if (score > 20) pipeSpeed = 5.5;

  if (score > 8) pipeGap = 150;
  if (score > 15) pipeGap = 135;
  if (score > 25) pipeGap = 120;

  let spawnRate = 100;
  if (score > 10) spawnRate = 90;
  if (score > 20) spawnRate = 80;

  if (frame % spawnRate === 0) addPipe();

  // Oppdater rør
  for (let i = pipes.length - 1; i >= 0; i--) {
    pipes[i].x -= pipeSpeed;

    if (!pipes[i].passed && pipes[i].x + pipeWidth < bird.x) {
      pipes[i].passed = true;
      score++;
    }

    if (pipes[i].x + pipeWidth < 0) pipes.splice(i, 1);
  }

  // Kollisjon med bakken/tak
  if (bird.y + bird.r > canvas.height - 60 || bird.y - bird.r < 0) {
    gameOver = true;
  }

  // Kollisjon med rør
  for (let p of pipes) {
    if (
      bird.x + bird.r > p.x &&
      bird.x - bird.r < p.x + pipeWidth &&
      (bird.y - bird.r < p.top || bird.y + bird.r > p.bottom)
    ) {
      gameOver = true;
    }
  }
}

// Tegn fugl
function drawBird() {
  ctx.fillStyle = "#ffeb3b";
  ctx.beginPath();
  ctx.arc(bird.x, bird.y, bird.r, 0, Math.PI * 2);
  ctx.fill();

  ctx.fillStyle = "#000";
  ctx.beginPath();
  ctx.arc(bird.x + 6, bird.y - 5, 3, 0, Math.PI * 2);
  ctx.fill();
}

// Tegn rør
function drawPipes() {
  for (let p of pipes) {
    ctx.fillStyle = "#2ecc71";
    ctx.fillRect(p.x, 0, pipeWidth, p.top);
    ctx.fillRect(p.x, p.bottom, pipeWidth, canvas.height - p.bottom - 60);

    ctx.fillStyle = "rgba(0,0,0,0.2)";
    ctx.fillRect(p.x + pipeWidth - 10, 0, 10, p.top);
    ctx.fillRect(p.x + pipeWidth - 10, p.bottom, 10, canvas.height - p.bottom - 60);
  }
}

// Bakgrunn
function drawBackground() {
  ctx.fillStyle = "#6ec9ff";
  ctx.fillRect(0, 0, canvas.width, canvas.height);

  ctx.fillStyle = "#d9c27a";
  ctx.fillRect(0, canvas.height - 60, canvas.width, 60);

  ctx.fillStyle = "#4caf50";
  ctx.fillRect(0, canvas.height - 70, canvas.width, 10);
}

// Tekst
function drawText() {
  ctx.fillStyle = "#fff";
  ctx.font = "28px Arial";
  ctx.fillText("Score: " + score, 20, 50);

  if (!started && !gameOver) {
    ctx.fillStyle = "#000";
    ctx.font = "40px Arial";
    let text = "Trykk SPACE for å starte";
    let textWidth = ctx.measureText(text).width;
    ctx.fillText(text, (canvas.width - textWidth) / 2, canvas.height / 2);
  }

  if (paused) {
    ctx.fillStyle = "#fff";
    ctx.font = "60px Arial";
    let text = "PAUSE";
    let textWidth = ctx.measureText(text).width;
    ctx.fillText(text, (canvas.width - textWidth) / 2, canvas.height / 2);
  }

  if (gameOver) {
    ctx.fillStyle = "#000";
    ctx.font = "50px Arial";
    let t1 = "GAME OVER";
    let t2 = "Score: " + score;
    let t3 = "Trykk SPACE for å restarte";

    let w1 = ctx.measureText(t1).width;
    ctx.fillText(t1, (canvas.width - w1) / 2, canvas.height / 2 - 40);

    ctx.font = "30px Arial";
    let w2 = ctx.measureText(t2).width;
    ctx.fillText(t2, (canvas.width - w2) / 2, canvas.height / 2 + 10);

    let w3 = ctx.measureText(t3).width;
    ctx.fillText(t3, (canvas.width - w3) / 2, canvas.height / 2 + 60);
  }
}

// Spill-loop
function loop() {
  update();
  drawBackground();
  drawPipes();
  drawBird();
  drawText();
  requestAnimationFrame(loop);
}

// Kontroller
document.addEventListener("keydown", (e) => {
  if (e.code === "Space") {
    e.preventDefault();

    if (!started) {
      started = true;
      return;
    }
    if (gameOver) {
      reset();
      return;
    }
    if (!paused) {
      bird.vel = bird.jump;
    }
  }

  if (e.code === "KeyP") {
    paused = !paused;
  }
});

// Start
reset();
loop();
</script>
</body>
</html>
