<!DOCTYPE html>
<html lang="no">
<head>
  <meta charset="UTF-8">
  <title>Flappy Bird-kopi</title>
  <style>
    body { margin: 0; background: #222; display: flex; justify-content: center; align-items: center; height: 100vh; }
    canvas { background: #70c5ce; border: 3px solid #000; }
  </style>
</head>
<body>
<canvas id="game" width="400" height="600"></canvas>

<script>
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");

let birdX = 80;
let birdY = canvas.height / 2;
let birdR = 15;
let birdVel = 0;
let gravity = 0.5;
let jump = -8;

let pipes = [];
let pipeWidth = 60;
let pipeGap = 140;
let pipeSpeed = 2.5;
let frame = 0;
let score = 0;
let gameOver = false;
let started = false;

function resetGame() {
  birdX = 80;
  birdY = canvas.height / 2;
  birdVel = 0;
  pipes = [];
  frame = 0;
  score = 0;
  gameOver = false;
  started = false;
}

function addPipe() {
  const topHeight = 50 + Math.random() * 250;
  pipes.push({
    x: canvas.width,
    top: topHeight,
    bottom: topHeight + pipeGap,
    passed: false
  });
}

function update() {
  if (!started || gameOver) return;

  birdVel += gravity;
  birdY += birdVel;

  // Legg til nye rør
  frame++;
  if (frame % 90 === 0) {
    addPipe();
  }

  // Oppdater rør
  for (let i = pipes.length - 1; i >= 0; i--) {
    pipes[i].x -= pipeSpeed;

    // Sjekk om fuglen passerer røret (score)
    if (!pipes[i].passed && pipes[i].x + pipeWidth < birdX) {
      pipes[i].passed = true;
      score++;
    }

    // Fjern rør som er ute av skjermen
    if (pipes[i].x + pipeWidth < 0) {
      pipes.splice(i, 1);
    }
  }

  // Kollisjon med bakken eller tak
  if (birdY + birdR > canvas.height || birdY - birdR < 0) {
    gameOver = true;
  }

  // Kollisjon med rør
  for (const p of pipes) {
    if (
      birdX + birdR > p.x &&
      birdX - birdR < p.x + pipeWidth &&
      (birdY - birdR < p.top || birdY + birdR > p.bottom)
    ) {
      gameOver = true;
    }
  }
}

function drawBird() {
  ctx.fillStyle = "#ffeb3b";
  ctx.beginPath();
  ctx.arc(birdX, birdY, birdR, 0, Math.PI * 2);
  ctx.fill();

  // lite øye
  ctx.fillStyle = "#000";
  ctx.beginPath();
  ctx.arc(birdX + 5, birdY - 5, 3, 0, Math.PI * 2);
  ctx.fill();
}

function drawPipes() {
  ctx.fillStyle = "#4caf50";
  for (const p of pipes) {
    // topp-rør
    ctx.fillRect(p.x, 0, pipeWidth, p.top);
    // bunn-rør
    ctx.fillRect(p.x, p.bottom, pipeWidth, canvas.height - p.bottom);
  }
}

function drawText() {
  ctx.fillStyle = "#fff";
  ctx.font = "28px Arial";
  ctx.fillText("Score: " + score, 10, 40);

  if (!started && !gameOver) {
    ctx.font = "24px Arial";
    ctx.fillText("Trykk SPACE for å starte", 40, canvas.height / 2);
  }

  if (gameOver) {
    ctx.font = "32px Arial";
    ctx.fillText("GAME OVER", 110, canvas.height / 2 - 20);
    ctx.font = "20px Arial";
    ctx.fillText("Score: " + score, 160, canvas.height / 2 + 10);
    ctx.fillText("Trykk SPACE for å restarte", 80, canvas.height / 2 + 40);
  }
}

function drawBackground() {
  // enkel bakke
  ctx.fillStyle = "#70c5ce";
  ctx.fillRect(0, 0, canvas.width, canvas.height);

  ctx.fillStyle = "#ded895";
  ctx.fillRect(0, canvas.height - 60, canvas.width, 60);

  ctx.fillStyle = "#4caf50";
  ctx.fillRect(0, canvas.height - 70, canvas.width, 10);
}

function loop() {
  update();

  drawBackground();
  drawPipes();
  drawBird();
  drawText();

  requestAnimationFrame(loop);
}

document.addEventListener("keydown", (e) => {
  if (e.code === "Space") {
    if (!started) {
      started = true;
    }
    if (gameOver) {
      resetGame();
      return;
    }
    birdVel = jump;
  }
});

resetGame();
loop();
</script>
</body>
</html>
