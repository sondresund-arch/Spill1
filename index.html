<!DOCTYPE html>
<html lang="no">
<head>
    <meta charset="UTF-8">
    <title>3D bilspill</title>
    <style>
        body {
            margin: 0;
            overflow: hidden;
            background: #000;
            font-family: Arial, sans-serif;
        }
        #info {
            position: absolute;
            top: 10px;
            left: 10px;
            color: #fff;
            z-index: 10;
        }
    </style>
</head>
<body>
<div id="info">Styr bilen med piltastene ← ↑ → ↓</div>

<!-- Three.js fra CDN -->
<script src="https://unpkg.com/three@0.160.0/build/three.min.js"></script>

<script>
    // Scene, kamera, renderer
    const scene = new THREE.Scene();
    scene.background = new THREE.Color(0x202030);

    const camera = new THREE.PerspectiveCamera(
        60,
        window.innerWidth / window.innerHeight,
        0.1,
        1000
    );

    const renderer = new THREE.WebGLRenderer({ antialias: true });
    renderer.setSize(window.innerWidth, window.innerHeight);
    document.body.appendChild(renderer.domElement);

    // Lys
    const ambientLight = new THREE.AmbientLight(0xffffff, 0.4);
    scene.add(ambientLight);

    const dirLight = new THREE.DirectionalLight(0xffffff, 0.8);
    dirLight.position.set(50, 100, 50);
    scene.add(dirLight);

    // Bakke
    const groundGeo = new THREE.PlaneGeometry(500, 500);
    const groundMat = new THREE.MeshPhongMaterial({ color: 0x404040 });
    const ground = new THREE.Mesh(groundGeo, groundMat);
    ground.rotation.x = -Math.PI / 2;
    scene.add(ground);

    // Enkle "bygninger"
    const buildingMat = new THREE.MeshPhongMaterial({ color: 0x223355 });
    function addBuilding(x, z, w, h, d) {
        const geo = new THREE.BoxGeometry(w, h, d);
        const mesh = new THREE.Mesh(geo, buildingMat);
        mesh.position.set(x, h / 2, z);
        scene.add(mesh);
    }

    addBuilding(-80, -80, 40, 60, 40);
    addBuilding(60, -100, 50, 80, 50);
    addBuilding(-120, 40, 60, 70, 40);
    addBuilding(100, 80, 70, 90, 50);
    addBuilding(0, 140, 80, 60, 60);

    // Veier (bare mørkere striper på bakken)
    const roadMat = new THREE.MeshPhongMaterial({ color: 0x303030 });
    function addRoad(x, z, w, d) {
        const geo = new THREE.BoxGeometry(w, 0.1, d);
        const mesh = new THREE.Mesh(geo, roadMat);
        mesh.position.set(x, 0.05, z);
        scene.add(mesh);
    }

    addRoad(0, 0, 40, 400);   // lang vei
    addRoad(-100, 0, 40, 300);
    addRoad(100, 0, 40, 300);
    addRoad(0, 100, 200, 40);
    addRoad(0, -100, 200, 40);

    // Bil
    const carBodyGeo = new THREE.BoxGeometry(4, 1.2, 2);
    const carBodyMat = new THREE.MeshPhongMaterial({ color: 0xff3333 });
    const car = new THREE.Mesh(carBodyGeo, carBodyMat);
    car.position.set(0, 0.6, 0);
    scene.add(car);

    // "Tak" / frontrute
    const cabinGeo = new THREE.BoxGeometry(2, 0.8, 1.6);
    const cabinMat = new THREE.MeshPhongMaterial({ color: 0xddddff });
    const cabin = new THREE.Mesh(cabinGeo, cabinMat);
    cabin.position.set(0, 1.2, -0.1);
    car.add(cabin);

    // Kamera startposisjon
    camera.position.set(0, 6, 10);
    camera.lookAt(car.position);

    // Input
    const keys = {
        ArrowUp: false,
        ArrowDown: false,
        ArrowLeft: false,
        ArrowRight: false
    };

    document.addEventListener("keydown", (e) => {
        if (keys.hasOwnProperty(e.key)) {
            keys[e.key] = true;
        }
    });

    document.addEventListener("keyup", (e) => {
        if (keys.hasOwnProperty(e.key)) {
            keys[e.key] = false;
        }
    });

    // Bilfysikk (enkel)
    let speed = 0;
    const maxSpeed = 0.5;
    const accel = 0.01;
    const friction = 0.005;
    const turnSpeed = 0.03;

    function updateCar() {
        // Akselerasjon
        if (keys.ArrowUp) {
            speed += accel;
        }
        if (keys.ArrowDown) {
            speed -= accel;
        }

        // Begrens fart
        if (speed > maxSpeed) speed = maxSpeed;
        if (speed < -maxSpeed / 2) speed = -maxSpeed / 2;

        // Friksjon
        if (!keys.ArrowUp && !keys.ArrowDown) {
            if (speed > 0) {
                speed -= friction;
                if (speed < 0) speed = 0;
            } else if (speed < 0) {
                speed += friction;
                if (speed > 0) speed = 0;
            }
        }

        // Svinging
        if (speed !== 0) {
            if (keys.ArrowLeft) {
                car.rotation.y += turnSpeed * (speed > 0 ? 1 : -1);
            }
            if (keys.ArrowRight) {
                car.rotation.y -= turnSpeed * (speed > 0 ? 1 : -1);
            }
        }

        // Bevegelse fremover
        const dir = new THREE.Vector3();
        car.getWorldDirection(dir); // peker fremover
        car.position.addScaledVector(dir, speed);
    }

    function updateCamera() {
        const offset = new THREE.Vector3(0, 4, 8); // bak og over bilen
        const rotatedOffset = offset.clone().applyAxisAngle(
            new THREE.Vector3(0, 1, 0),
            car.rotation.y
        );

        const targetPos = car.position.clone().add(rotatedOffset);
        camera.position.lerp(targetPos, 0.1);
        camera.lookAt(car.position.clone().add(new THREE.Vector3(0, 1, 0)));
    }

    function animate() {
        requestAnimationFrame(animate);

        updateCar();
        updateCamera();

        renderer.render(scene, camera);
    }

    animate();

    // Håndter vindusstørrelse
    window.addEventListener("resize", () => {
        camera.aspect = window.innerWidth / window.innerHeight;
        camera.updateProjectionMatrix();
        renderer.setSize(window.innerWidth, window.innerHeight);
    });
</script>
</body>
</html>
